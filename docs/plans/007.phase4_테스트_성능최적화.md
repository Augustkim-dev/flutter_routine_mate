# 007. Phase 4: í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ìµœì í™”

## ğŸ“‹ ì‘ì—… ê°œìš”
**ëª©í‘œ**: ì•± ì•ˆì •ì„± í™•ë³´ ë° ì„±ëŠ¥ ìµœì í™”
**ì˜ˆìƒ ê¸°ê°„**: 2ì¼
**ìš°ì„ ìˆœìœ„**: P0 (í•„ìˆ˜)

## ğŸ¯ ì‘ì—… ëª©í‘œ
1. í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ êµ¬ì¶•
2. ì„±ëŠ¥ ë³‘ëª© ì§€ì  íŒŒì•… ë° ê°œì„ 
3. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
4. ì• ë‹ˆë©”ì´ì…˜ ìµœì í™” (60fps)
5. ë°°í„°ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì†Œí™”

## ğŸ“‚ ìƒì„±í•  í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°
```
test/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”‚       â””â”€â”€ database_helper_test.dart
â”‚   â””â”€â”€ features/
â”‚       â””â”€â”€ routine/
â”‚           â”œâ”€â”€ data/
â”‚           â”‚   â”œâ”€â”€ models/
â”‚           â”‚   â”‚   â”œâ”€â”€ routine_model_test.dart
â”‚           â”‚   â”‚   â””â”€â”€ completion_record_model_test.dart
â”‚           â”‚   â””â”€â”€ repositories/
â”‚           â”‚       â””â”€â”€ routine_repository_test.dart
â”‚           â””â”€â”€ domain/
â”‚               â””â”€â”€ entities/
â”‚                   â””â”€â”€ routine_test.dart
â”œâ”€â”€ widget/
â”‚   â””â”€â”€ features/
â”‚       â””â”€â”€ routine/
â”‚           â””â”€â”€ presentation/
â”‚               â”œâ”€â”€ screens/
â”‚               â”‚   â””â”€â”€ home_screen_test.dart
â”‚               â””â”€â”€ widgets/
â”‚                   â”œâ”€â”€ routine_card_test.dart
â”‚                   â””â”€â”€ routine_form_test.dart
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ routine_crud_test.dart
â”‚   â”œâ”€â”€ completion_flow_test.dart
â”‚   â””â”€â”€ filter_sort_test.dart
â””â”€â”€ golden/
    â”œâ”€â”€ routine_card_golden_test.dart
    â””â”€â”€ home_screen_golden_test.dart
```

## ğŸ”§ ìƒì„¸ êµ¬í˜„ ê³„íš

### 1. Unit í…ŒìŠ¤íŠ¸

#### 1.1 ëª¨ë¸ í…ŒìŠ¤íŠ¸
```dart
// routine_model_test.dart
group('RoutineModel', () {
  test('should create routine with valid data', () {});
  test('should validate name length', () {});
  test('should serialize to JSON correctly', () {});
  test('should deserialize from JSON correctly', () {});
  test('should calculate isCompletedToday correctly', () {});
  test('should calculate currentStreak correctly', () {});
  test('should calculate completionRate correctly', () {});
});
```

#### 1.2 Repository í…ŒìŠ¤íŠ¸
```dart
// routine_repository_test.dart
group('RoutineRepository', () {
  late MockDatabaseHelper mockDatabase;
  late RoutineRepositoryImpl repository;

  setUp(() {
    mockDatabase = MockDatabaseHelper();
    repository = RoutineRepositoryImpl(mockDatabase);
  });

  test('getAllRoutines returns sorted list', () async {});
  test('createRoutine generates UUID and saves', () async {});
  test('toggleCompletion updates completion history', () async {});
  test('deleteRoutine performs soft delete', () async {});
  test('handles database errors gracefully', () async {});
});
```

#### 1.3 Provider í…ŒìŠ¤íŠ¸
```dart
// routine_list_provider_test.dart
group('RoutineListProvider', () {
  test('initial state is loading', () {});
  test('loads routines on initialization', () {});
  test('optimistic update works correctly', () {});
  test('rollback on error', () {});
  test('filter and sort work together', () {});
});
```

### 2. Widget í…ŒìŠ¤íŠ¸

#### 2.1 ë£¨í‹´ ì¹´ë“œ í…ŒìŠ¤íŠ¸
```dart
// routine_card_test.dart
testWidgets('RoutineCard shows correct UI for unchecked state', (tester) async {});
testWidgets('RoutineCard shows check icon when completed', (tester) async {});
testWidgets('Tapping routine card triggers callback', (tester) async {});
testWidgets('Long press shows context menu', (tester) async {});
testWidgets('Swipe gesture triggers delete', (tester) async {});
```

#### 2.2 í™ˆ í™”ë©´ í…ŒìŠ¤íŠ¸
```dart
// home_screen_test.dart
testWidgets('HomeScreen shows empty state when no routines', (tester) async {});
testWidgets('HomeScreen displays routine list', (tester) async {});
testWidgets('FAB opens bottom sheet', (tester) async {});
testWidgets('Pull to refresh works', (tester) async {});
```

### 3. Integration í…ŒìŠ¤íŠ¸

```dart
// routine_crud_test.dart
testWidgets('User can create and check routine', (tester) async {
  app.main();
  await tester.pumpAndSettle();

  // 1. FAB íƒ­í•˜ì—¬ ë°”í…€ì‹œíŠ¸ ì—´ê¸°
  // 2. ë£¨í‹´ ì •ë³´ ì…ë ¥
  // 3. ì €ì¥ ë²„íŠ¼ íƒ­
  // 4. ë£¨í‹´ ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œ í™•ì¸
  // 5. ë£¨í‹´ ì²´í¬í•˜ê¸°
  // 6. ì²´í¬ ìƒíƒœ í™•ì¸
  // 7. ì•± ì¬ì‹œì‘ í›„ ìƒíƒœ ìœ ì§€ í™•ì¸
});
```

### 4. Golden í…ŒìŠ¤íŠ¸

```dart
// routine_card_golden_test.dart
testWidgets('RoutineCard golden test - all states', (tester) async {
  final routine = Routine(/*...*/);

  // Unchecked state
  await tester.pumpWidget(/*...*/);
  await expectLater(find.byType(RoutineCard),
    matchesGoldenFile('goldens/routine_card_unchecked.png'));

  // Checked state
  routine.isCompletedToday = true;
  await tester.pumpWidget(/*...*/);
  await expectLater(find.byType(RoutineCard),
    matchesGoldenFile('goldens/routine_card_checked.png'));
});
```

### 5. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

#### 5.1 ë Œë”ë§ ì„±ëŠ¥
```dart
test('List renders 100 items in <16ms', () async {
  final stopwatch = Stopwatch()..start();

  // 100ê°œ ë£¨í‹´ ë Œë”ë§
  await tester.pumpWidget(/*...*/);

  stopwatch.stop();
  expect(stopwatch.elapsedMilliseconds, lessThan(16)); // 60fps
});
```

#### 5.2 ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
```dart
test('Database operations complete in acceptable time', () async {
  // Insert: < 50ms
  // Query: < 30ms
  // Update: < 40ms
  // Delete: < 30ms
});
```

#### 5.3 ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§
```dart
test('No memory leaks in provider lifecycle', () async {
  // Provider ìƒì„±/ì‚­ì œ ë°˜ë³µ
  // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
  // Leak ê°ì§€
});
```

### 6. ì„±ëŠ¥ ìµœì í™” ì‘ì—…

#### 6.1 ìœ„ì ¯ ìµœì í™”
```dart
// const ìƒì„±ì í™œìš©
const RoutineCard({required this.routine});

// RepaintBoundary ì ìš©
RepaintBoundary(
  child: AnimatedContainer(/*...*/)
);

// ListView.builder itemExtent ì„¤ì •
ListView.builder(
  itemExtent: 80.0, // ê³ ì • ë†’ì´ë¡œ ì„±ëŠ¥ í–¥ìƒ
);
```

#### 6.2 ìƒíƒœ ê´€ë¦¬ ìµœì í™”
```dart
// selectë¥¼ í†µí•œ ë¶ˆí•„ìš”í•œ rebuild ë°©ì§€
final routineName = ref.watch(
  routineProvider.select((routine) => routine.name)
);

// family modifierë¡œ ê°œë³„ ê´€ë¦¬
final routineProvider = StateNotifierProvider.family<
  RoutineNotifier, Routine, String
>((ref, id) => RoutineNotifier(id));
```

#### 6.3 ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”
```dart
// AnimationController ì¬ì‚¬ìš©
class _RoutineCardState extends State<RoutineCard>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: Duration(milliseconds: 250),
      vsync: this,
    );
  }
}
```

## ğŸ¯ ì„±ëŠ¥ ëª©í‘œ

### ì•± ì‹œì‘ ì‹œê°„
- Cold start: < 2ì´ˆ
- Warm start: < 0.5ì´ˆ

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- ì´ˆê¸° ì‹¤í–‰: < 50MB
- ì¼ë°˜ ì‚¬ìš©: < 100MB
- í”¼í¬ ì‚¬ìš©: < 150MB

### í”„ë ˆì„ ë ˆì´íŠ¸
- ìŠ¤í¬ë¡¤: 60fps ìœ ì§€
- ì• ë‹ˆë©”ì´ì…˜: 60fps ìœ ì§€
- ì²´í¬ í† ê¸€: < 200ms ì‘ë‹µ

### ë°°í„°ë¦¬ ì‚¬ìš©ëŸ‰
- ì¼ì¼ ì‚¬ìš©: < 1%
- ë°±ê·¸ë¼ìš´ë“œ: ìµœì†Œí™”

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ
- Unit í…ŒìŠ¤íŠ¸: 90% ì´ìƒ
- Widget í…ŒìŠ¤íŠ¸: 80% ì´ìƒ
- Integration í…ŒìŠ¤íŠ¸: ì£¼ìš” í”Œë¡œìš° 100%

## âš ï¸ ì£¼ì˜ì‚¬í•­
1. **í…ŒìŠ¤íŠ¸ ê²©ë¦¬**
   - ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰
   - setUp/tearDown í™œìš©
   - Mock ë°ì´í„° ì‚¬ìš©

2. **CI/CD í†µí•©**
   - GitHub Actions ì„¤ì •
   - ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
   - ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸

3. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**
   - Flutter DevTools í™œìš©
   - Performance Overlay
   - Memory Profiler

## ğŸ¯ ì™„ë£Œ ê¸°ì¤€
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ ë‹¬ì„±
- [ ] ëª¨ë“  ì„±ëŠ¥ ëª©í‘œ ì¶©ì¡±
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—†ìŒ
- [ ] 60fps ìœ ì§€
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„
Phase 5: í™ˆ ìœ„ì ¯ êµ¬í˜„ìœ¼ë¡œ ì§„í–‰ (Post-MVP)