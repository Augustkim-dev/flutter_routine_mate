# 012. 요일 설정 기능 구현 계획

## 📋 작업 개요
- **작업명**: 루틴 추가/수정 화면에 요일 설정 기능 추가
- **작업 유형**: 기능 추가
- **예상 소요 시간**: 2시간
- **우선순위**: P0 (MVP 필수 기능)

## 🎯 작업 목표
루틴 추가/수정 시 사용자가 루틴을 수행할 요일을 선택할 수 있도록 하여, 개인의 일정에 맞는 맞춤형 루틴 관리를 가능하게 합니다.

## 🔍 현재 상황 분석

### 문제점
1. 루틴 생성 시 요일 설정이 `ScheduleType.daily`로 하드코딩됨
2. RoutineForm에 요일 선택 UI가 없음
3. 사용자가 평일/주말만 하거나 특정 요일만 하는 루틴을 만들 수 없음

### 기존 구현 상태
- ✅ `ScheduleType` enum 구현 완료 (daily, weekday, weekend, custom)
- ✅ `Routine` 엔티티에 scheduleType과 customDays 필드 존재
- ✅ 데이터베이스 스키마에 schedule_type과 custom_days 컬럼 존재
- ❌ UI에서 요일 설정 기능 누락

## 📝 구현 계획

### 1. RoutineForm 위젯 수정
**파일**: `lib/features/routine/presentation/widgets/routine_form.dart`

#### 추가할 State 변수
```dart
late ScheduleType _selectedScheduleType;
Set<int> _selectedCustomDays = {};
```

#### UI 구성
1. **반복 요일 섹션** (색상 선택 아래 추가)
   - 제목: "반복 요일"
   - 빠른 선택 버튼 (SegmentedButton)
     - 매일 (ScheduleType.daily)
     - 평일 (ScheduleType.weekday)
     - 주말 (ScheduleType.weekend)
     - 커스텀 (ScheduleType.custom)

2. **커스텀 요일 선택** (커스텀 선택 시만 표시)
   - 월~일 각 요일별 ChoiceChip
   - 최소 1개 이상 선택 필수
   - 선택된 요일은 primary 색상으로 하이라이트

3. **미리보기 섹션 업데이트**
   - 선택된 요일 정보 표시
   - 예: "매일", "월-금", "월, 수, 금"

### 2. HomeScreen 수정
**파일**: `lib/features/routine/presentation/screens/home_screen.dart`

#### 루틴 생성 시 (line 60-70)
```dart
final routine = Routine(
  // ... 기존 필드들 ...
  scheduleType: routineData['scheduleType'] ?? ScheduleType.daily,
  customDays: routineData['customDays'],
  // ...
);
```

#### 루틴 수정 시 (line 250-256)
```dart
child: RoutineForm(
  routine: {
    // ... 기존 필드들 ...
    'scheduleType': routine.scheduleType,
    'customDays': routine.customDays,
  },
  // ...
),
```

### 3. RoutineCard 위젯 수정
**파일**: `lib/features/routine/presentation/widgets/routine_card.dart`

#### 요일 정보 표시 추가
- 루틴 이름 아래에 작은 텍스트로 표시
- `routine.scheduleDescription` 활용
- 스타일: `AppTextStyles.caption` with `textSecondary` 색상

## 🎨 UI/UX 디자인

### 요일 선택 UI 레이아웃
```
┌─────────────────────────────────┐
│  반복 요일                        │
│                                   │
│  [매일] [평일] [주말] [커스텀]     │ ← SegmentedButton
│                                   │
│  월  화  수  목  금  토  일        │ ← ChoiceChips (커스텀 선택 시)
│  ●   ●   ●   ●   ●   ○   ○       │
└─────────────────────────────────┘
```

### 색상 및 스타일
- 선택된 버튼: `AppColors.primary` 배경
- 비선택 버튼: `AppColors.surface` 배경
- 선택된 요일 칩: `AppColors.primary` 배경, 흰색 텍스트
- 비선택 요일 칩: 투명 배경, 테두리만

### 인터랙션
- 버튼/칩 선택 시 햅틱 피드백 (`HapticFeedback.selectionClick()`)
- 애니메이션: 200ms 페이드 전환
- 커스텀 선택 시 요일 칩 슬라이드 다운 애니메이션

## 🧪 테스트 계획

### 단위 테스트
1. 각 ScheduleType별 선택 및 저장 테스트
2. customDays 데이터 변환 테스트 (Set<int> ↔ List<int>)
3. 요일 설명 텍스트 생성 테스트

### 통합 테스트
1. 루틴 생성 플로우
   - 매일/평일/주말 선택 → 저장 → 리스트 확인
   - 커스텀 요일 선택 → 저장 → 리스트 확인

2. 루틴 수정 플로우
   - 기존 요일 설정 표시 확인
   - 요일 변경 → 저장 → 변경사항 반영 확인

3. 검증 로직
   - 커스텀 선택 시 최소 1개 요일 선택 검증
   - 요일 미선택 시 에러 메시지 표시

### 사용자 시나리오 테스트
1. 평일에만 하는 운동 루틴 생성
2. 주말에만 하는 청소 루틴 생성
3. 월/수/금만 하는 공부 루틴 생성
4. 매일 하는 루틴을 평일로 변경

## 📊 예상 결과

### 사용자 경험 개선
- 개인 일정에 맞는 맞춤형 루틴 설정 가능
- 불필요한 알림 감소 (해당 요일에만 활성화)
- 더 현실적인 달성률 계산

### 기술적 개선
- 데이터 모델과 UI의 완전한 연동
- 확장 가능한 스케줄 시스템 구축
- 향후 반복 패턴 추가 용이 (격주, 매월 등)

## 🔧 구현 순서

1. RoutineForm에 요일 선택 UI 구성 요소 추가
2. State 관리 로직 구현
3. 데이터 변환 및 검증 로직 추가
4. HomeScreen에서 데이터 전달 로직 수정
5. RoutineCard에 요일 정보 표시 추가
6. 테스트 및 디버깅
7. 작업 일지 작성

## 📚 참고 자료

### 관련 파일
- `lib/features/routine/domain/entities/schedule_type.dart`
- `lib/features/routine/domain/entities/routine.dart`
- `lib/features/routine/presentation/widgets/routine_form.dart`
- `lib/features/routine/presentation/screens/home_screen.dart`

### Flutter 위젯
- [SegmentedButton](https://api.flutter.dev/flutter/material/SegmentedButton-class.html)
- [ChoiceChip](https://api.flutter.dev/flutter/material/ChoiceChip-class.html)
- [AnimatedContainer](https://api.flutter.dev/flutter/widgets/AnimatedContainer-class.html)

## ⚠️ 주의사항

1. **데이터 일관성**: customDays는 1(월요일)~7(일요일) 범위의 정수 사용
2. **NULL 처리**: custom이 아닌 경우 customDays는 null 또는 빈 리스트
3. **마이그레이션**: 기존 루틴들은 모두 daily로 처리
4. **성능**: 요일별 필터링 시 인덱스 활용 고려