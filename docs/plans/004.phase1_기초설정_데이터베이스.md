# 004. Phase 1: ê¸°ì´ˆ ì„¤ì • ë° ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•

## ğŸ“‹ ì‘ì—… ê°œìš”
**ëª©í‘œ**: SQLite ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë° ê¸°ë³¸ ë°ì´í„° ëª¨ë¸ êµ¬í˜„
**ì˜ˆìƒ ê¸°ê°„**: 2ì¼
**ìš°ì„ ìˆœìœ„**: P0 (í•„ìˆ˜)

## ğŸ¯ ì‘ì—… ëª©í‘œ
1. SQLite ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ë° í…Œì´ë¸” ìƒì„±
2. ë°ì´í„° ëª¨ë¸ í´ë˜ìŠ¤ êµ¬í˜„
3. Repository íŒ¨í„´ êµ¬í˜„
4. DAO í´ë˜ìŠ¤ ì‘ì„±
5. ê¸°ë³¸ CRUD ì‘ì—… í…ŒìŠ¤íŠ¸

## ğŸ“‚ ìƒì„±í•  íŒŒì¼ êµ¬ì¡°
```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ database_helper.dart
â”‚   â”‚   â””â”€â”€ app_database.dart
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ constants.dart
â”‚       â””â”€â”€ uuid_generator.dart
â””â”€â”€ features/
    â””â”€â”€ routine/
        â”œâ”€â”€ data/
        â”‚   â”œâ”€â”€ models/
        â”‚   â”‚   â”œâ”€â”€ routine_model.dart
        â”‚   â”‚   â”œâ”€â”€ completion_record_model.dart
        â”‚   â”‚   â””â”€â”€ app_settings_model.dart
        â”‚   â”œâ”€â”€ datasources/
        â”‚   â”‚   â””â”€â”€ routine_local_datasource.dart
        â”‚   â””â”€â”€ repositories/
        â”‚       â””â”€â”€ routine_repository_impl.dart
        â””â”€â”€ domain/
            â”œâ”€â”€ entities/
            â”‚   â”œâ”€â”€ routine.dart
            â”‚   â”œâ”€â”€ completion_record.dart
            â”‚   â””â”€â”€ schedule_type.dart
            â””â”€â”€ repositories/
                â””â”€â”€ routine_repository.dart
```

## ğŸ”§ ìƒì„¸ êµ¬í˜„ ê³„íš

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (database_helper.dart)
```dart
// ì£¼ìš” ê¸°ëŠ¥:
- SQLite ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
- í…Œì´ë¸” ìƒì„± (routines, completion_records, app_settings, analytics_data)
- ì¸ë±ìŠ¤ ìƒì„±
- ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œì§
- ë°ì´í„°ë² ì´ìŠ¤ ë²„ì „ ê´€ë¦¬
```

### 2. ëª¨ë¸ í´ë˜ìŠ¤
```dart
// routine_model.dart
- id: String (UUID)
- name: String (1-20ì)
- iconIndex: int (0-29)
- colorIndex: int (0-7)
- scheduleType: ScheduleType enum
- customDays: List<int>?
- sortOrder: int
- reminderTime: String?
- isReminderEnabled: bool
- createdAt: DateTime
- updatedAt: DateTime
- deletedAt: DateTime? (soft delete)

// completion_record_model.dart
- id: int (auto-increment)
- routineId: String
- date: String (YYYY-MM-DD)
- isCompleted: bool
- completedAt: DateTime?
- note: String?
- createdAt: DateTime
```

### 3. Repository êµ¬í˜„
```dart
// routine_repository.dart (abstract)
abstract class RoutineRepository {
  Future<List<Routine>> getAllRoutines();
  Future<Routine?> getRoutineById(String id);
  Future<String> createRoutine(Routine routine);
  Future<void> updateRoutine(Routine routine);
  Future<void> deleteRoutine(String id);
  Future<void> toggleCompletion(String routineId, DateTime date);
  Future<Map<String, bool>> getCompletionHistory(String routineId);
  Stream<List<Routine>> watchRoutines();
}

// routine_repository_impl.dart
- SQLite íŠ¸ëœì­ì…˜ ì²˜ë¦¬
- ì—ëŸ¬ í•¸ë“¤ë§
- ë°ì´í„° ë³€í™˜ (Entity â†” Model)
```

### 4. DAO (Data Access Object)
```dart
// routine_dao.dart
- insert, update, delete, select ì¿¼ë¦¬
- ë³µì¡í•œ ì¿¼ë¦¬ (í†µê³„, í•„í„°ë§)
- ë°°ì¹˜ ì‘ì—…
- íŠ¸ëœì­ì…˜ ê´€ë¦¬
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš
1. **ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸**
   - í…Œì´ë¸” ìƒì„± í™•ì¸
   - CRUD ì‘ì—… í…ŒìŠ¤íŠ¸
   - íŠ¸ëœì­ì…˜ ë¡¤ë°± í…ŒìŠ¤íŠ¸

2. **ëª¨ë¸ í…ŒìŠ¤íŠ¸**
   - JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”
   - ìœ íš¨ì„± ê²€ì¦
   - ê¸°ë³¸ê°’ í…ŒìŠ¤íŠ¸

3. **Repository í…ŒìŠ¤íŠ¸**
   - ëª¨ë“  ë©”ì„œë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
   - ì—ëŸ¬ ì¼€ì´ìŠ¤ ì²˜ë¦¬
   - Stream í…ŒìŠ¤íŠ¸

## ğŸ“¦ í•„ìš”í•œ íŒ¨í‚¤ì§€
```yaml
dependencies:
  sqflite: ^2.3.0
  path: ^1.8.3
  uuid: ^4.2.1

dev_dependencies:
  sqflite_common_ffi: ^2.3.0  # ë°ìŠ¤í¬í†± í…ŒìŠ¤íŠ¸ìš©
  mockito: ^5.4.3
  build_runner: ^2.4.7
```

## âš ï¸ ì£¼ì˜ì‚¬í•­
1. **ë°ì´í„°ë² ì´ìŠ¤ ë²„ì „ ê´€ë¦¬**
   - ì´ˆê¸° ë²„ì „ì€ 1ë¡œ ì„¤ì •
   - í–¥í›„ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì½”ë“œ í•„ìˆ˜

2. **Soft Delete êµ¬í˜„**
   - deleted_at í•„ë“œ í™œìš©
   - ì‹¤ì œ ì‚­ì œ ëŒ€ì‹  í”Œë˜ê·¸ ì²˜ë¦¬
   - 30ì¼ í›„ ìë™ ì‚­ì œ ë°°ì¹˜ ì‘ì—… ê³ ë ¤

3. **ì¸ë±ìŠ¤ ìµœì í™”**
   - routine_id + date ë³µí•© ì¸ë±ìŠ¤
   - deleted_at ë‹¨ì¼ ì¸ë±ìŠ¤
   - ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

4. **íŠ¸ëœì­ì…˜ ì²˜ë¦¬**
   - ë£¨í‹´ ì‚­ì œ ì‹œ completion_recordsë„ í•¨ê»˜ ì‚­ì œ
   - ì™„ë£Œ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±

## ğŸ¯ ì™„ë£Œ ê¸°ì¤€
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì„±ê³µ
- [ ] ëª¨ë“  í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] ê¸°ë³¸ CRUD ì‘ì—… ì •ìƒ ë™ì‘
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨ 90% ì´ìƒ
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ êµ¬í˜„ ì™„ë£Œ

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„
Phase 2: í•µì‹¬ UI ë° ë£¨í‹´ ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„ìœ¼ë¡œ ì§„í–‰